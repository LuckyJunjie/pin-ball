# Pinball v4.0 – Implementation Summary

## How to Run v4.0

Set the main scene to **MainMenuV4** to run the v4.0 I/O Pinball clone:

- In Godot: Project → Project Settings → Application → Run → Main Scene → `res://scenes/MainMenuV4.tscn`
- Or temporarily change `project.godot`: `run/main_scene="res://scenes/MainMenuV4.tscn"`

Flow: **Play** → **Select Character** (Sparky, Dino, Dash, Android) → **How to Play** → **Start Game** → MainV4 playfield. **Back to Menu** from game returns to main; **Replay** after game over returns to character select.

---

## Implemented (Minimum Viable v4.0)

### State and flow

- **GameManagerV4** (autoload): round_score, total_score, multiplier (1–6), rounds (3), bonus_history, status (waiting, playing, gameOver). Signals: scored, round_lost, bonus_activated, multiplier_increased, game_over, game_started. add_score(), on_round_lost(), increase_multiplier(), add_bonus(), start_game(), ball spawn at launcher, bonus ball timer (5s).
- **Start flow**: MainMenuV4 – initial (Play) → selectCharacter (4 themes) → howToPlay → change to MainV4 and start_game().
- **Game over**: When rounds == 0, GameManagerV4 emits game_over; UIV4 shows GameOverPanel (final score, Replay). Replay loads MainMenuV4.

### Playfield and physics

- **MainV4.tscn**: Playfield (background, walls with bottom gap), Drain (Area2D), SkillShot (Area2D 1M), Balls node, Launcher (reuse), Flippers (reuse), UI (score, multiplier, rounds, game over panel, back button), SoundManager.
- **DrainV4.gd**: body_entered(Ball) → remove ball; if was last ball, GameManagerV4.on_round_lost().
- **Ball**: Spawned at launcher by GameManagerV4 (frozen until Launcher picks it up). Launcher uses existing input (Space / launch_ball). Flippers use flipper_left / flipper_right.
- **SkillShotV4.gd**: body_entered(Ball) → GameManagerV4.add_score(1000000), play sound.

### UI and audio

- **UIV4.gd**: Connects to GameManagerV4 scored, round_lost, multiplier_increased, game_started, game_over; updates ScoreLabel, MultiplierLabel, RoundsLabel; shows GameOverPanel on game_over; Replay → MainMenuV4.
- **SoundManager**: Present in MainV4; SkillShotV4 calls play_sound("obstacle_hit"). Other sounds (ball_launch, ball_lost, flipper_click) used by Launcher/Ball if connected (Launcher in v4 receives ball from spawn, not BallQueue).

---

## Files Added

| Path | Purpose |
|------|---------|
| design-v4.0/FLUTTER-PINBALL-PARSING.md | Parsing summary of Flutter I/O Pinball |
| design-v4.0/README.md | Index of v4.0 docs |
| design-v4.0/Requirements-v4.0.md | Requirements |
| design-v4.0/GDD-v4.0.md | Game Design Document |
| design-v4.0/Technical-Design-v4.0.md | Technical design |
| design-v4.0/Game-Flow-v4.0.md | State and flow |
| design-v4.0/Component-Specifications-v4.0.md | Component specs |
| design-v4.0/Asset-Requirements-v4.0.md | Asset list |
| design-v4.0/V4.0-IMPLEMENTATION-SUMMARY.md | This file |
| scripts/v4/GameManagerV4.gd | Game state (autoload) |
| scripts/v4/DrainV4.gd | Drain behavior |
| scripts/v4/MainV4.gd | Main scene init and start_game |
| scripts/v4/UIV4.gd | HUD and game over |
| scripts/v4/MainMenuV4.gd | Start flow |
| scripts/v4/SkillShotV4.gd | Skill shot 1M |
| scenes/MainV4.tscn | Playfield scene |
| scenes/MainMenuV4.tscn | Start menu scene |

**project.godot**: Autoload `GameManagerV4="*res://scripts/v4/GameManagerV4.gd"` added.

---

## Not Yet Implemented (Expand Later)

- **Zones**: Android Acres, Dino Desert, Google Gallery, Flutter Forest, Sparky Scorch (bumpers, ramp, bonuses). Add zone scripts and nodes per Component-Specifications-v4.0.md; call GameManagerV4.add_score(), add_bonus(), increase_multiplier() (ramp every 5 hits).
- **Bonus ball**: GameManagerV4 has 5s timer and _spawn_bonus_ball() at bonus_ball_spawn_position; trigger by add_bonus(googleWord) or add_bonus(dashNest). Multiball indicators (4) and zone completion logic (Google Word, Dash Nest) not yet in scene.
- **Backbox**: Leaderboard, initials input, share. Use BackboxManagerV4 and Backbox scene per Technical-Design-v4.0.md; local leaderboard storage.
- **Camera**: Camera behavior per status (waiting, playing, gameOver) zoom/position.
- **Character theme**: Selection stored but not yet applied to ball sprite or leaderboard icon (single ball sprite used).

---

## Testing Checklist

1. Run MainMenuV4 → Play → pick character → How to Play → Start Game → MainV4 loads, one ball spawns at launcher.
2. Space to launch; Left/A and Right/D for flippers. Ball drains → round lost; after 3 rounds, game over panel with Replay.
3. Hit SkillShot area (center, y≈200) for 1M points; score and multiplier/rounds update.
4. Back to Menu from game; Replay after game over returns to character select.
