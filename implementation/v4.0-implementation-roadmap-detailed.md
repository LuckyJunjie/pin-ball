# v4.0 Detailed Implementation Roadmap

## Phase 1: Foundation Fixes (Week 1)

### Day 1: Fix Core Scoring System
1. **Fix GameManagerV4 scoring calculation**
   - Update `add_score()` to match Flutter's `totalScore + (roundScore × multiplier)`
   - Fix `on_round_lost()` to apply multiplier to round score
   - Update `display_score()` to show correct total

2. **Create BumperV4 base class**
   - Base class for all bumper types (Android, Dash, Sparky)
   - Common behavior: lighting, scoring, visual feedback
   - Signal emission for hits and state changes

### Day 2: Complete Android Acres Scene
1. **Create missing scene components**
   - `scenes/zones/AndroidAcres/SpaceshipRamp.tscn`
   - `scenes/zones/AndroidAcres/AndroidBumperA.tscn`
   - `scenes/zones/AndroidAcres/AndroidBumperB.tscn`
   - `scenes/zones/AndroidAcres/AndroidBumperCow.tscn`
   - `scenes/zones/AndroidAcres/AndroidSpaceship.tscn`

2. **Implement component scripts**
   - `scripts/v4/components/SpaceshipRampV4.gd`
   - `scripts/v4/components/AndroidBumperV4.gd`
   - `scripts/v4/components/AndroidSpaceshipV4.gd`

### Day 3: Zone Integration
1. **Update AndroidAcresV4.gd integration**
   - Connect to new scene components
   - Implement ramp hit tracking for multiplier
   - Complete bumper lighting sequence
   - Finish spaceship target behavior

2. **Test Android Acres functionality**
   - Unit tests for zone behavior
   - Integration tests with GameManagerV4
   - Visual verification in game

### Day 4: Backbox Flow Completion
1. **Fix BackboxManagerV4 state transitions**
   - Complete all state transitions (LOADING → LEADERBOARD → INITIALS → SHARE)
   - Implement local leaderboard storage
   - Add validation for initials input

2. **Update UIV4.gd for complete flow**
   - Smooth transitions between backbox states
   - Visual feedback for state changes
   - Proper error handling

### Day 5: Testing & Bug Fixes
1. **Comprehensive testing**
   - Test scoring system with multiplier
   - Test Android Acres zone interactions
   - Test backbox flow from start to finish

2. **Bug fixes and polish**
   - Fix any issues found during testing
   - Performance optimization
   - Visual polish

## Phase 2: Zone Implementation (Week 2)

### Day 6: Google Gallery Zone
1. **Create Google Gallery components**
   - `scenes/zones/GoogleGallery/GoogleLetter.tscn` (6 instances)
   - `scenes/zones/GoogleGallery/GoogleRollover.tscn`
   - `scripts/v4/components/GoogleLetterV4.gd`
   - `scripts/v4/components/GoogleRolloverV4.gd`

2. **Implement GoogleGalleryV4.gd**
   - Letter completion tracking (G-O-O-G-L-E)
   - Word completion bonus activation
   - Rollover scoring (5k each)

### Day 7: Dino Desert Zone
1. **Create Dino Desert components**
   - `scenes/zones/DinoDesert/ChromeDino.tscn`
   - `scenes/zones/DinoDesert/DinoSlingshot.tscn`
   - `scripts/v4/components/ChromeDinoV4.gd`
   - `scripts/v4/components/DinoSlingshotV4.gd`

2. **Implement DinoDesertV4.gd**
   - Dino chomp bonus activation
   - Slingshot behavior and scoring
   - Dino wall interactions

### Day 8: Flutter Forest Zone
1. **Create Flutter Forest components**
   - `scenes/zones/FlutterForest/DashBumper.tscn` (3 instances)
   - `scenes/zones/FlutterForest/DashSignpost.tscn`
   - `scripts/v4/components/DashBumperV4.gd`
   - `scripts/v4/components/DashSignpostV4.gd`

2. **Implement FlutterForestV4.gd**
   - Dash bumper lighting sequence
   - Dash nest bonus activation
   - Signpost interaction and scoring

### Day 9: Sparky Scorch Zone
1. **Create Sparky Scorch components**
   - `scenes/zones/SparkyScorch/SparkyBumper.tscn` (3 instances)
   - `scenes/zones/SparkyScorch/SparkyComputer.tscn`
   - `scripts/v4/components/SparkyBumperV4.gd`
   - `scripts/v4/components/SparkyComputerV4.gd`

2. **Implement SparkyScorchV4.gd**
   - Sparky bumper lighting
   - Computer target activation
   - Turbo charge bonus

### Day 10: Zone Integration Testing
1. **Test all zones**
   - Individual zone functionality
   - Zone-to-zone interactions
   - Bonus system integration

2. **Performance testing**
   - Memory usage with all zones loaded
   - Frame rate during multi-zone interactions
   - Asset loading performance

## Phase 3: Systems Integration (Week 3)

### Day 11: Multiplier System
1. **Create multiplier indicators**
   - `scenes/components/MultiplierIndicator.tscn` (x2-x6)
   - `scripts/v4/components/MultiplierIndicatorV4.gd`
   - Visual feedback for multiplier levels

2. **Implement ramp hit tracking**
   - Track hits across all zones
   - Multiplier increase every 5 hits
   - Visual progression feedback

### Day 12: Bonus System Completion
1. **Implement all bonus types**
   - Google Word bonus (complete word)
   - Dash Nest bonus (all bumpers lit)
   - Sparky Turbo Charge bonus
   - Dino Chomp bonus
   - Android Spaceship bonus

2. **Bonus ball spawning**
   - Proper timing (5-second delay)
   - Visual feedback for bonus activation
   - Sound effects for bonuses

### Day 13: Character Theme Integration
1. **Create CharacterThemeManagerV4.gd**
   - Theme switching logic
   - Asset loading for themes
   - Visual feedback for theme changes

2. **Implement theme assets**
   - Load ball variants for each theme
   - Theme-specific UI elements
   - Zone visual variations by theme

### Day 14: Sound System
1. **Implement zone-specific sounds**
   - Bumper hit sounds by type
   - Ramp hit sounds
   - Bonus activation sounds
   - UI interaction sounds

2. **Sound management**
   - Volume control
   - Sound pooling for performance
   - Spatial audio where appropriate

## Phase 4: Layout and Playfield Reconstruction (Week 4)

### Day 15: Analyze Flutter Playfield Structure
1. **Study Flutter Pinball component hierarchy**
   - Analyze `PinballGame.onLoad()` component tree
   - Map Flutter coordinate system to Godot
   - Document component positioning and relationships

2. **Create component positioning reference**
   - Extract coordinates from Flutter components
   - Convert Forge2D coordinates to Godot pixel coordinates
   - Create positioning guide for all zones and components

### Day 16: Redesign MainV4.tscn Layout
1. **Remove incorrect bumper placement**
   - Remove 5 bumpers from middle of screen
   - Remove incorrect ramp placement
   - Clean up playfield structure

2. **Recreate Flutter component hierarchy**
   - Add proper zone containers (AndroidAcres, DinoDesert, FlutterForest, SparkyScorch)
   - Add GoogleGallery, Multipliers, Multiballs components
   - Add proper ramp structures
   - Position components according to Flutter coordinates

3. **Fix component positioning**
   - Position flippers according to Flutter calculations
   - Position launcher correctly
   - Add proper drain component
   - Add skill shot component

### Day 17: Implement Missing Zones
1. **Create DinoDesert zone**
   - Scene structure and components
   - Dino chomp behavior
   - Scoring integration

2. **Create FlutterForest zone**
   - Dash nest components
   - Visual effects
   - Bonus activation

3. **Create SparkyScorch zone**
   - Sparky turbo charge components
   - Lighting effects
   - Multiplier behavior

### Day 18: Add Missing Components
1. **GoogleGallery implementation**
   - Visual representation
   - Scoring behavior
   - Integration with game flow

2. **Multipliers component**
   - Multiplier tracking
   - Visual feedback
   - Integration with ramp hits

3. **Multiballs component**
   - Multi-ball spawning
   - Timing and coordination
   - Visual effects

## Phase 5: Polish & Testing (Week 5)

### Day 19: UI/UX Polish
1. **Animations and transitions**
   - Smooth scene transitions
   - Animated score popups
   - Visual feedback for interactions

2. **HUD improvements**
   - Better multiplier display
   - Visual ball indicators
   - Bonus status indicators

### Day 16: Performance Optimization
1. **Object pooling**
   - Ball pooling optimization
   - Effect pooling for hits/bonuses
   - Sound instance pooling

2. **Asset management**
   - Lazy loading of zone assets
   - Memory management between games
   - Texture compression optimization

### Day 17: Comprehensive Testing
1. **Unit testing**
   - Test all zone scripts
   - Test GameManagerV4 and BackboxManagerV4
   - Test component scripts

2. **Integration testing**
   - Test zone interactions
   - Test bonus system integration
   - Test complete game flow

### Day 18: Bug Fixing & Final Adjustments
1. **Bug fixing**
   - Fix any remaining issues
   - Performance optimization
   - Visual polish

2. **Final testing**
   - End-to-end gameplay testing
   - Performance validation
   - Parity verification with Flutter

## Technical Implementation Details

### 1. Scoring System Fix
```gdscript
# Current (incorrect):
func add_score(points: int) -> void:
    if status != Status.PLAYING:
        return
    round_score += points
    scored.emit(points)

# Fixed (matches Flutter):
func add_score(points: int) -> void:
    if status != Status.PLAYING:
        return
    round_score += points
    # Emit points before multiplier for UI display
    scored.emit(points)
    # Total score calculation happens in display_score()
```

### 2. Bumper Base Class Structure
```gdscript
class_name BumperV4 extends RigidBody2D

enum BumperType { ANDROID, DASH, SPARKY }

signal bumper_hit(points: int, bumper_id: String)
signal bumper_lit_changed(is_lit: bool)

var bumper_type: BumperType
var bumper_id: String
var is_lit: bool = false
var base_points: int = 20000
var lit_multiplier: int = 2

func _on_body_entered(body: Node) -> void:
    if body.is_in_group("balls"):
        var points = base_points * (lit_multiplier if is_lit else 1)
        bumper_hit.emit(points, bumper_id)
        toggle_lit_state()
```

### 3. Zone Integration Pattern
```gdscript
# Each zone follows this pattern:
class_name ZoneBaseV4 extends Node2D

signal zone_activated(bonus_type: GameManagerV4.Bonus)
signal zone_score(points: int)

func _ready() -> void:
    add_to_group("zones")
    connect_components()
    initialize_zone_state()

func connect_components() -> void:
    # Connect all child components
    for child in get_children():
        if child.has_signal("component_hit"):
            child.component_hit.connect(_on_component_hit)

func _on_component_hit(points: int, component_id: String) -> void:
    GameManagerV4.add_score(points)
    zone_score.emit(points)
    update_zone_progress(component_id)
```

### 4. Test Strategy
1. **Unit Tests**: Test individual components in isolation
2. **Integration Tests**: Test component interactions
3. **Gameplay Tests**: Test complete game flow
4. **Performance Tests**: Test frame rate and memory usage

### 5. Asset Management Strategy
1. **Placeholder Assets**: Use simple shapes during development
2. **Progressive Enhancement**: Replace placeholders with final assets
3. **Asset Bundles**: Group assets by zone for efficient loading
4. **Memory Management**: Unload unused assets between games

## Success Metrics

### Phase 1 Completion Criteria
- ✅ Scoring system matches Flutter calculation
- ✅ Android Acres zone fully functional
- ✅ Backbox flow complete from start to finish
- ✅ All tests passing for implemented features

### Phase 2 Completion Criteria
- ✅ All 5 zones implemented and functional
- ✅ Zone-specific bonuses working
- ✅ Zone integration tests passing
- ✅ Performance targets met for all zones

### Phase 3 Completion Criteria
- ✅ Multiplier system with visual indicators
- ✅ Complete bonus system with all 5 types
- ✅ Character theme integration
- ✅ Sound system with zone-specific sounds

### Phase 4 Completion Criteria
- ✅ UI/UX polish with animations
- ✅ Performance optimization complete
- ✅ Comprehensive test coverage (> 80%)
- ✅ Parity with Flutter reference verified

## Risk Mitigation

### Technical Risks
1. **Performance Issues**: Implement object pooling early, profile regularly
2. **Asset Integration**: Use placeholder assets, implement asset loader abstraction
3. **Physics Consistency**: Test against Flutter reference, adjust physics parameters

### Schedule Risks
1. **Zone Complexity**: Start with simplest zone, use common patterns
2. **Testing Overhead**: Implement tests alongside features, not after
3. **Integration Issues**: Regular integration testing throughout development

## Next Steps

### Immediate Actions (Day 1)
1. Fix GameManagerV4 scoring calculation
2. Create BumperV4 base class
3. Start Android Acres scene components

### Weekly Checkpoints
- **Week 1**: Foundation fixes complete
- **Week 2**: All zones implemented
- **Week 3**: Systems integration complete
- **Week 4**: Polish and testing complete

---
*Implementation Roadmap Version: 1.0*
*Created: 2026-02-01*
*Based on: v4.0 Gap Analysis and Flutter Pinball reference*